# Spotilike –ü–µ—Ç-–ø—Ä–æ–µ–∫—Ç: Roadmap (MVP)

# –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—ç—Ç–∞–ø–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ backend-—Å–∏—Å—Ç–µ–º—ã –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –º—É–∑—ã–∫–∏.

---

## Phase 0: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –°—Ä–µ–¥–∞ (Local Env)
**–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ—á–≤—É. –ù–∏–∫–∞–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏, —Ç–æ–ª—å–∫–æ "—Ç—Ä—É–±—ã" –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.

### –ó–∞–¥–∞—á–∏
- [ ] **Docker Compose:**
    - [ ] PostgreSQL (—Å volume –¥–ª—è –¥–∞–Ω–Ω—ã—Ö).
    - [ ] Redis (–¥–ª—è –∫–µ—à–∞).
    - [ ] Kafka + Zookeeper (–∏–ª–∏ Kraft mode).
    - [ ] **MinIO** (–õ–æ–∫–∞–ª—å–Ω–∞—è –∑–∞–º–µ–Ω–∞ S3/Cloudflare R2).
- [ ] **Project Shells:** –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—É—Å—Ç—ã–µ Spring Boot/Python –ø—Ä–æ–µ–∫—Ç—ã –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ (`gateway`, `user`, `catalog`, `processor`).

### Definition of Done (DoD)
1. –ö–æ–º–∞–Ω–¥–∞ `docker-compose up -d` –ø–æ–¥–Ω–∏–º–∞–µ—Ç –≤—Å–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–µ–∑ –æ—à–∏–±–æ–∫.
2. –î–æ—Å—Ç—É–ø–Ω–∞ –∞–¥–º–∏–Ω–∫–∞ MinIO (`localhost:9001`) —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä.
3. –ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Postgres —á–µ—Ä–µ–∑ DBeaver –∏ –≤–∏–¥–µ—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

---

## Phase 1: Gateway & Identity (User Service)
**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É. –ë–µ–∑ —ç—Ç–æ–≥–æ –Ω–µ—Ç —Å–º—ã—Å–ª–∞ –¥–µ–ª–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω–æ–µ.

### –ó–∞–¥–∞—á–∏
- [ ] **User Service:**
    - [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å PostgreSQL + Flyway/Liquibase –∏ Hibernate.
    - [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã `users`, `roles`, `refresh_tokens`.
    - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API: Registration, Login (Return Access + Refresh Tokens).
    - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ç–æ–∫–µ–Ω–æ–≤ (Public Key endpoint).
- [ ] **Gateway Service:**
    - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Spring Cloud Gateway.
    - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `GlobalFilter` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization`.
    - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–æ—É—Ç–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤ (`/auth/**` -> User Service, `/users/**` -> User Service).

### üèÅ Definition of Done (DoD)
1. Postman: `POST /auth/register` —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î.
2. Postman: `POST /auth/login` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT.
3. Postman: `GET /users/me` (—Å —Ç–æ–∫–µ–Ω–æ–º) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å.
4. Postman: `GET /users/me` (–±–µ–∑ —Ç–æ–∫–µ–Ω–∞) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 Unauthorized –æ—Ç Gateway.

---

## Phase 2: Catalog Service (Core Domain)
**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–ê—Ä—Ç–∏—Å—Ç—ã, –ê–ª—å–±–æ–º—ã, –¢—Ä–µ–∫–∏).
**–í–∞–∂–Ω–æ:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–Ω—è—Ç–∏–π User –∏ Artist (—Å–º. —Å—Ö–µ–º—É –ë–î).

### –ó–∞–¥–∞—á–∏
- [ ] **Database Schema:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã `artists`, `artist_managers`, `albums`, `tracks`, `track_artists`.
- [ ] **Artist API:**
    - [ ] "–°—Ç–∞—Ç—å –∞—Ä—Ç–∏—Å—Ç–æ–º" (—Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è + –ø—Ä–∏–≤—è–∑–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞).
    - [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–æ/–∞–≤–∞—Ç–∞—Ä–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –º–µ–Ω–µ–¥–∂–µ—Ä–∞).
- [ ] **Content API:**
    - [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ê–ª—å–±–æ–º–∞.
    - [ ] –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¢—Ä–µ–∫–∞ (—Å—Ç–∞—Ç—É—Å `NO_FILE`).
- [ ] **Integration:** –°–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –∏–∑–≤–ª–µ–∫–∞—Ç—å `userId` –∏–∑ JWT –∑–∞–≥–æ–ª–æ–≤–∫–∞, –ø—Ä–æ–±—Ä–æ—à–µ–Ω–Ω–æ–≥–æ –ì–µ–π—Ç–≤–µ–µ–º.

### Definition of Done (DoD)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ê—Ä—Ç–∏—Å—Ç–∞.
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ê–ª—å–±–æ–º –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–µ–≥–æ –¢—Ä–µ–∫ (—Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ, –±–µ–∑ –∞—É–¥–∏–æ).
3. –ü–æ–ø—ã—Ç–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á—É–∂–æ–≥–æ –∞—Ä—Ç–∏—Å—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 403 Forbidden.

---

## Phase 3: Audio Processing Pipeline (Hardcore)
**–¶–µ–ª—å:** –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞, —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥ –≤ HLS, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.

### –ó–∞–¥–∞—á–∏
- [ ] **Upload Flow (Catalog Service):**
    - [ ] Endpoint `POST /tracks/{id}/upload`.
    - [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ MinIO (bucket `raw`).
    - [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –≤ Kafka: `topic: upload.completed` (payload: `{trackId, fileKey}`).
- [ ] **Processing Service (Worker):**
    - [ ] Kafka Consumer –¥–ª—è `upload.completed`.
    - [ ] –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ MinIO –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é.
    - [ ] **FFmpeg:** –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è OGG/MP3 -> HLS (.m3u8 + .ts chunks).
    - [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ MinIO (bucket `public`).
    - [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è: `topic: processing.completed`.
- [ ] **State Update:**
    - [ ] Catalog Service —Å–ª—É—à–∞–µ—Ç `processing.completed`.
    - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Ç—Ä–µ–∫–∞: `is_available = true` –∏ `file_key`.

### Definition of Done (DoD)
1. –ó–∞–≥—Ä—É–∂–∞–µ–º `.mp3` —Ñ–∞–π–ª —á–µ—Ä–µ–∑ API.
2. –ß–µ—Ä–µ–∑ ~30-60 —Å–µ–∫—É–Ω–¥ –≤ MinIO –±–∞–∫–µ—Ç–µ `public` –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–∞–ø–∫–∞ —Å `.ts` —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏.
3. –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É —Ç—Ä–µ–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã–π.

---

## Phase 4: Streaming Service
**–¶–µ–ª—å:** –î–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### –ó–∞–¥–∞—á–∏
- [ ] **Endpoint:** `GET /stream/{trackId}`.
- [ ] **Security:** –ü—Ä–æ–≤–µ—Ä–∫–∞, –∏–º–µ–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∞–≤–æ —Å–ª—É—à–∞—Ç—å (–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ - –∑–∞–≥–ª—É—à–∫–∞).
- [ ] **Presigned URLs:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏ –Ω–∞ `master.m3u8` —Ñ–∞–π–ª –≤ MinIO/S3.
- [ ] **Playback History:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —Ñ–∞–∫—Ç–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –≤ –ë–î (–∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –≤ Kafka).

### Definition of Done (DoD)
1. –ó–∞–ø—Ä–æ—Å –∫ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–ª–∏–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MinIO.
2. –≠—Ç—É —Å—Å—ã–ª–∫—É –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ VLC Player –∏–ª–∏ Safari Browser –∏ –º—É–∑—ã–∫–∞ –∏–≥—Ä–∞–µ—Ç.
3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ FFmpeg) —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## Tech Stack Summary

| Component | Technology | Purpose |
| :--- | :--- | :--- |
| **Language** | Java 17/21 (Spring Boot 3) | User, Catalog, Gateway |
| **Processing** | Python (FastAPI) or Java | FFmpeg wrapping |
| **Database** | PostgreSQL 15+ | Relational Data |
| **Message Broker** | Kafka | Async communication |
| **Cache** | Redis | Sessions, Rate Limiting |
| **Storage** | MinIO (Dev) / Cloudflare R2 | Object Storage (Audio) |
| **Discovery** | DNS / Docker Network | Simple Service Discovery |